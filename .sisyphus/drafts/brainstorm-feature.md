# Draft: Brainstorm Feature (Full Implementation)

## Research Findings

### Tech Stack
- **Monorepo**: pnpm workspaces + Turbo
- **Frontend**: Next.js (apps/desktop-ui), Tailwind CSS, shadcn/ui, Framer Motion
- **Backend**: Express.js (apps/api), Zod validation
- **Database**: PostgreSQL via Prisma ORM (packages/db)
- **Desktop**: Tauri (optional wrapper)
- **Tests**: Vitest + Supertest

### Existing Brainstorm (Frontend Only — MOCK DATA)
- `apps/desktop-ui/components/global-quick-capture.tsx` — Has a working UI but uses hardcoded MOCK_TASKS
- `apps/desktop-ui/components/god-mode-overlay.tsx` — Dispatches `brainstorm-query` custom events
- **Current flow**: User types prompt → 1.8s fake delay → shows 4 hardcoded mock tasks → "Insert" toggles local state only
- **NO backend endpoint for brainstorm**
- **NO LLM call** — entirely mock
- **NO real task creation** on insert — just toggles `inserted: boolean` in local state
- **NO interview/questions step** — goes straight from prompt to tasks

### Existing Task Creation Pattern
- API: `POST /api/tasks` with Zod validation (CreateTaskSchema)
- Fields: title, description, priority, labelIds, teamId, projectId, dueDate
- Team association auto-resolves via project's team
- SSE broadcast on creation: `broadcast('task:created', transformedTask)`
- Frontend API client: `apps/desktop-ui/lib/api/tasks.ts`

### AI Provider Infrastructure
- Settings page has "AI Providers" section that configures LLM provider API keys
- Keys are stored in Docker containers via OpenCode SDK
- The AI keys are for task EXECUTION (coding agents), not for brainstorm generation
- No direct LLM API call infrastructure in the backend currently

### Database Schema (relevant)
- Task model: id, title, description, priority, status, teamId, projectId, labels, etc.
- Project model: linked to teams via ProjectTeam
- Priority enum: low, medium, high
- Status enum: todo, in_progress, done, cancelled

## Requirements (confirmed)
- User enters a prompt describing what they want to build/fix
- System asks clarifying questions about the prompt (interview phase)
- After answering, 3-10 todo items are generated by AI
- User picks/selects which items they want
- User can "add to project" to create real tasks

## Technical Decisions (all confirmed)
- **LLM Provider**: User-configured provider keys from Settings (reuse existing OpenCode container setup)
- **Interview Phase**: AI generates 3-5 context-dependent questions based on the user's prompt
- **Streaming**: Stream tasks one-by-one via SSE (matches existing stagger animation pattern)
- **UI Approach**: Rework existing sidebar panel (global-quick-capture.tsx) — add interview phase, replace mock data
- **Project Selection**: Show project picker BEFORE adding tasks (user picks project, then selected tasks get created under it)

## Open Questions
- Test strategy: TBD (project has Vitest + Supertest)

## Scope Boundaries
- INCLUDE: Backend brainstorm API endpoint, LLM integration via user's provider keys, interview/questions phase, frontend rework of sidebar panel, real task creation via POST /api/tasks, project picker, SSE streaming
- EXCLUDE: Persisting brainstorm sessions in DB (ephemeral), new Prisma models, changes to god-mode overlay (already works), changes to existing task schema
